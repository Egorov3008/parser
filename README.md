# Pyrogram Telegram Parser –¥–ª—è OpenClaw

–ü—Ä–æ—Å—Ç–æ–π –ø–∞—Ä—Å–µ—Ä Telegram-—Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ [Pyrogram](https://docs.pyrogram.org/), –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–æ–≤ –∏ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞, –∑–∞—Ç–µ–º –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ [OpenClaw Gateway](https://github.com/openclaw/gateway) —á–µ—Ä–µ–∑ WebSocket —Å JSON-—Ñ—Ä–µ–π–º–∞–º–∏.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø–∞—Ä—Å–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä/–∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è OpenClaw –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram-–∫–∞–Ω–∞–ª–∞—Ö
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (DM)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–ø–∏—Å–∫–æ–º –∫–∞–Ω–∞–ª–æ–≤ —á–µ—Ä–µ–∑ OpenClaw
- –í–∫–ª—é—á–∞—Ç—å/–æ—Ç–∫–ª—é—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —É—Ä–æ–≤–Ω–µ–º –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- `pyrogram==2.0.106` - MTProto –∫–ª–∏–µ–Ω—Ç –¥–ª—è Telegram
- `tgcrypto` - –£—Å–∫–æ—Ä–µ–Ω–∏–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- `websockets>=12.0` - WebSocket –∫–ª–∏–µ–Ω—Ç
- `python-dotenv>=1.0` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```bash
cp .env.example .env
```

```env
# Telegram API credentials
TELEGRAM_API_ID=123456789
TELEGRAM_API_HASH=abcdef1234567890abcdef1234567890

# –ò–º—è —Å–µ—Å—Å–∏–∏ (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª parser_session.session)
TELEGRAM_SESSION_NAME=parser_session

# OpenClaw Gateway
OPENCLAW_GATEWAY_URL=ws://localhost:3000
OPENCLAW_GATEWAY_TOKEN=your_secret_token_here

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=INFO
LOG_FILE=logs/parser.log
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ Telegram API –∫–ª—é—á–µ–π

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [my.telegram.org](https://my.telegram.org)
2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "API development tools"
4. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–∏—Ç–µ `api_id` –∏ `api_hash`

### 4. –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞

```bash
python main.py
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –≤–∞—Å –ø–æ–ø—Ä–æ—Å—è—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ Telegram. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –≤ –∫–æ–Ω—Å–æ–ª–∏.

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä—Å–µ—Ä –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ OpenClaw Gateway –∏ –Ω–∞—á–Ω—ë—Ç —Å–ª—É—à–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
parser/
‚îú‚îÄ‚îÄ main.py                      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py                    # –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ .env
‚îú‚îÄ‚îÄ logger.py                    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ tg_client.py                 # Pyrogram –∫–ª–∏–µ–Ω—Ç –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îú‚îÄ‚îÄ gateway_client.py            # WebSocket –∫–ª–∏–µ–Ω—Ç –¥–ª—è OpenClaw Gateway
‚îú‚îÄ‚îÄ channel_registry.py          # –†–µ–µ—Å—Ç—Ä –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞
‚îú‚îÄ‚îÄ command_handler.py           # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –æ—Ç OpenClaw
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ channel_handler.py       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ private_handler.py       # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (DM)
‚îú‚îÄ‚îÄ .env.example                 # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ requirements.txt             # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ README.md                    # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è |
|-----------|---------|--------------|-------------|
| `TELEGRAM_API_ID` | ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Telegram API | - | ‚úÖ –î–∞ |
| `TELEGRAM_API_HASH` | Hash –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Telegram API | - | ‚úÖ –î–∞ |
| `TELEGRAM_SESSION_NAME` | –ò–º—è —Å–µ—Å—Å–∏–∏ Pyrogram | `parser_session` | ‚ùå –ù–µ—Ç |
| `OPENCLAW_GATEWAY_URL` | URL WebSocket —Å–µ—Ä–≤–µ—Ä–∞ OpenClaw | `ws://localhost:3000` | ‚ùå –ù–µ—Ç |
| `OPENCLAW_GATEWAY_TOKEN` | –¢–æ–∫–µ–Ω –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ OpenClaw | - | ‚úÖ –î–∞ |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARNING, ERROR) | `INFO` | ‚ùå –ù–µ—Ç |
| `LOG_FILE` | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤ | `logs/parser.log` | ‚ùå –ù–µ—Ç |

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
LOG_LEVEL=DEBUG      # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ
LOG_FILE=logs/parser.log  # –°–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ —Ñ–∞–π–ª
```

**–§–æ—Ä–º–∞—Ç—Ç –ª–æ–≥–æ–≤:**
```
[2025-02-25 20:36:42,123] INFO parser.main: Starting Telegram Parser for OpenClaw
[2025-02-25 20:36:42,456] DEBUG parser.gateway: Sending connect frame: {...}
```

**–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
- `DEBUG` - –í—Å–µ –¥–µ—Ç–∞–ª–∏ —Ñ—Ä–µ–π–º–æ–≤, –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `INFO` - –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –∫–æ–º–∞–Ω–¥—ã, —Å–æ–æ–±—â–µ–Ω–∏—è)
- `WARNING` - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)
- `ERROR` - –û—à–∏–±–∫–∏ (–∏—Å–∫–ª—é—á–µ–Ω–∏—è, –æ—Ç–∫–∞–∑—ã –æ–ø–µ—Ä–∞—Ü–∏–π)

## üì° WebSocket –ø—Ä–æ—Ç–æ–∫–æ–ª OpenClaw

### Handshake (–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)

–ü–∞—Ä—Å–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ—Ä–µ–π–º —Å HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å—é:

```json
{
  "type": "connect",
  "nonce": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6",
  "signature": "sha256_signature_of_token+nonce"
}
```

OpenClaw –æ—Ç–≤–µ—Ç–∏—Ç:
```json
{
  "type": "connected",
  "ok": true
}
```

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π

–ü–∞—Ä—Å–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ —Å–æ–±—ã—Ç–∏—è:

```json
{
  "type": "req",
  "id": 1,
  "method": "message.ingest",
  "params": {
    "channel_id": 1234567890,
    "channel_username": "@mychannel",
    "channel_title": "My Channel",
    "message_id": 42,
    "text": "Hello, World!",
    "timestamp": 1708884000.0,
    "from_user": {
      "id": 987654321,
      "username": "user123",
      "first_name": "John"
    }
  }
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥

OpenClaw –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä—Å–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:

```json
{
  "type": "req",
  "id": 1,
  "method": "channel.add",
  "params": {
    "username": "@example_channel"
  }
}
```

–ü–∞—Ä—Å–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç:
```json
{
  "type": "res",
  "id": 1,
  "ok": true,
  "payload": {
    "username": "@example_channel",
    "added": true
  }
}
```

## üéØ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã

### `channel.add`

–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª –≤ —Å–ø–∏—Å–æ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "type": "req",
  "id": 1,
  "method": "channel.add",
  "params": {
    "username": "@channel_name"
  }
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "type": "res",
  "id": 1,
  "ok": true,
  "payload": {
    "username": "@channel_name",
    "added": true
  }
}
```

**–û—Ç–≤–µ—Ç (–æ—à–∏–±–∫–∞):**
```json
{
  "type": "res",
  "id": 1,
  "ok": false,
  "error": "Missing 'username' parameter"
}
```

### `channel.remove`

–£–¥–∞–ª–∏—Ç—å –∫–∞–Ω–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "type": "req",
  "id": 2,
  "method": "channel.remove",
  "params": {
    "username": "@channel_name"
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "type": "res",
  "id": 2,
  "ok": true,
  "payload": {
    "username": "@channel_name",
    "removed": true
  }
}
```

### `bot.enable`

–í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –≥–ª–æ–±–∞–ª—å–Ω–æ.

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "type": "req",
  "id": 3,
  "method": "bot.enable",
  "params": {}
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "type": "res",
  "id": 3,
  "ok": true,
  "payload": {
    "enabled": true
  }
}
```

### `bot.disable`

–û—Ç–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –≥–ª–æ–±–∞–ª—å–Ω–æ.

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "type": "req",
  "id": 4,
  "method": "bot.disable",
  "params": {}
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "type": "res",
  "id": 4,
  "ok": true,
  "payload": {
    "enabled": false
  }
}
```

## üìä –°–æ–±—ã—Ç–∏—è (message.ingest)

### –°–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞

```json
{
  "type": "req",
  "id": 100,
  "method": "message.ingest",
  "params": {
    "channel_id": 1234567890,
    "channel_username": "@news_channel",
    "channel_title": "–í–∞–∂–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏",
    "message_id": 12345,
    "text": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
    "timestamp": 1708884000.123,
    "from_user": {
      "id": 987654321,
      "username": "admin",
      "first_name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
    }
  }
}
```

### –õ–∏—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (DM)

```json
{
  "type": "req",
  "id": 101,
  "method": "message.ingest",
  "params": {
    "chat_id": 987654321,
    "message_id": 54321,
    "text": "–ü—Ä–∏–≤–µ—Ç!",
    "timestamp": 1708884000.456,
    "from_user": {
      "id": 123456789,
      "username": "john_doe",
      "first_name": "John"
    }
  }
}
```

## üîç –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

–í –∫–æ–Ω—Å–æ–ª–∏:
```bash
python main.py
```

–í —Ñ–∞–π–ª–µ (–µ—Å–ª–∏ LOG_FILE —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):
```bash
tail -f logs/parser.log
```

### –£—Ä–æ–≤–Ω–∏ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏

**DEBUG** - –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
```env
LOG_LEVEL=DEBUG
```

–í—ã–≤–µ–¥–µ—Ç –≤—Å–µ —Ñ—Ä–µ–π–º—ã WebSocket:
```
[2025-02-25 20:36:42,123] DEBUG parser.gateway: Sending connect frame: {...}
[2025-02-25 20:36:42,456] DEBUG parser.gateway: Received frame: {"type": "connected", ...}
[2025-02-25 20:36:43,789] DEBUG parser.handler.channel: Sending channel message: {...}
```

**INFO** - –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
```env
LOG_LEVEL=INFO
```

–í—ã–≤–µ–¥–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:
```
[2025-02-25 20:36:42,123] INFO parser.main: Starting Telegram Parser for OpenClaw
[2025-02-25 20:36:42,456] INFO parser.gateway: Successfully connected to OpenClaw Gateway
[2025-02-25 20:36:43,789] INFO parser.registry: Added channel @example_channel
```

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞

```bash
$ python main.py
[2025-02-25 20:36:42,123] INFO parser.main: Starting Telegram Parser for OpenClaw
[2025-02-25 20:36:42,456] INFO parser.gateway: Connecting to OpenClaw Gateway at ws://localhost:3000
[2025-02-25 20:36:43,789] INFO parser.gateway: Successfully connected to OpenClaw Gateway
[2025-02-25 20:36:44,000] INFO parser.main: Starting Pyrogram client
[2025-02-25 20:36:45,111] INFO parser.main: Pyrogram client started
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞

OpenClaw –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç:
```json
{
  "type": "req",
  "id": 1,
  "method": "channel.add",
  "params": {"username": "@news"}
}
```

–í –ª–æ–≥–µ –ø–∞—Ä—Å–µ—Ä–∞:
```
[2025-02-25 20:36:50,000] INFO parser.command: Received command: method=channel.add, params={'username': '@news'}
[2025-02-25 20:36:50,100] INFO parser.registry: Added channel @news
[2025-02-25 20:36:50,200] DEBUG parser.gateway: Sending raw frame: {'type': 'res', 'id': 1, 'ok': True, 'payload': {...}}
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–∞

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∫–∞–Ω–∞–ª @news:
```
[2025-02-25 20:36:55,000] DEBUG parser.handler.channel: Sending channel message: {...}
[2025-02-25 20:36:55,100] DEBUG parser.gateway: Sending req frame: {'type': 'req', 'id': 1, 'method': 'message.ingest', 'params': {...}}
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞: "TELEGRAM_API_ID and TELEGRAM_API_HASH are required"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `.env` –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã `TELEGRAM_API_ID` –∏ `TELEGRAM_API_HASH`.

```bash
cat .env | grep TELEGRAM
```

### –û—à–∏–±–∫–∞: "Failed to handshake with OpenClaw Gateway"

**–ü—Ä–∏—á–∏–Ω–∞:**
- OpenClaw Gateway –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º URL
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `OPENCLAW_GATEWAY_URL`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `OPENCLAW_GATEWAY_TOKEN`
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä OpenClaw –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```bash
curl -i ws://localhost:3000  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
```

### –°–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–∞ –Ω–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ö–∞–Ω–∞–ª –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Ä–µ–µ—Å—Ç—Ä
- –ë–æ—Ç –æ—Ç–∫–ª—é—á–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω–æ
- –ö–∞–Ω–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∞–∫–∫–∞—É–Ω—Ç—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–Ω–∞–ª –¥–æ–±–∞–≤–ª–µ–Ω: `channel.add` –∫–æ–º–∞–Ω–¥–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –≤–∫–ª—é—á–µ–Ω –ª–∏ –±–æ—Ç: `bot.enable` –∫–æ–º–∞–Ω–¥–∞
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∞–∫–∫–∞—É–Ω—Ç –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–Ω–∞–ª—É
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å `LOG_LEVEL=DEBUG`

### –°–µ—Å—Å–∏—è Pyrogram –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –§–∞–π–ª —Å–µ—Å—Å–∏–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–ª.

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª —Å–µ—Å—Å–∏–∏ –∏ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å:

```bash
rm parser_session.session
python main.py
# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª –≤ git
- `.env` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`
- –•—Ä–∞–Ω–∏—Ç–µ `OPENCLAW_GATEWAY_TOKEN` –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–º –º–µ—Å—Ç–µ

### –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã:**
   ```
   OPENCLAW_GATEWAY_TOKEN=<–¥–ª–∏–Ω–Ω—ã–π_—Å–ª—É—á–∞–π–Ω—ã–π_—Ç–æ–∫–µ–Ω>
   ```

2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ù–µ –≤–∫–ª—é—á–∞–π—Ç–µ `LOG_LEVEL=DEBUG` –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

3. **–î–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç Telegram –¥–ª—è –ø–∞—Ä—Å–µ—Ä–∞

4. **HTTPS/WSS:** –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞—â–∏—â—ë–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

- [Pyrogram Documentation](https://docs.pyrogram.org/)
- [websockets Documentation](https://websockets.readthedocs.io/)
- [python-dotenv Documentation](https://python-dotenv.readthedocs.io/)

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pip install -r requirements.txt

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
python -m py_compile *.py handlers/*.py

# –ó–∞–ø—É—Å–∫ —Å DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
LOG_LEVEL=DEBUG python main.py

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f logs/parser.log | grep -E "INFO|ERROR"
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë• –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ç–∏–Ω–≥

–ü—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è pull requests —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å `LOG_LEVEL=DEBUG`
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å OpenClaw Gateway
4. –û—Ç–∫—Ä–æ–π—Ç–µ issue —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∏ –ª–æ–≥–∞–º–∏
