# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Pyrogram Telegram Parser

## üèóÔ∏è –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Telegram Network (MTProto)               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ (Pyrogram Client)
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Pyrogram TG Client                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Handlers:                                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ @on_message(filters.channel)                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ @on_message(filters.private)                       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ (Message objects)
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   Message Handlers                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Channel Handler:                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç registry.is_active(username)           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –í—ã–∑—ã–≤–∞–µ—Ç gateway.send_event("message.ingest")    ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Private Handler:                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç registry.enabled                       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ DM                              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ –í—ã–∑—ã–≤–∞–µ—Ç gateway.send_event("message.ingest")    ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ (JSON frames)
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 Gateway Client (WebSocket)                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ send_event(method, params)                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Üí {type:"req", id, method, params}                   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ listen(callback)                                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Üí {type:"req", method, params} ‚Üícallback            ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ send_raw(response_frame)                              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚Üí {type:"res", id, ok, payload|error}               ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚îÇ (WebSocket)
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              OpenClaw Gateway (ws://localhost:3000)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. config.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env` —Ñ–∞–π–ª–∞
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–≤ main.py)
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:**
```python
TELEGRAM_API_ID          # int
TELEGRAM_API_HASH        # str
TELEGRAM_SESSION_NAME    # str
OPENCLAW_GATEWAY_URL     # str
OPENCLAW_GATEWAY_TOKEN   # str
LOG_LEVEL               # str (DEBUG, INFO, WARNING, ERROR)
LOG_FILE                # str (path) –∏–ª–∏ –ø—É—Å—Ç–æ
```

### 2. logger.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –°–æ–∑–¥–∞—Ç—å –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–≥–µ—Ä "parser"
- –î–æ–±–∞–≤–∏—Ç—å StreamHandler –¥–ª—è –∫–æ–Ω—Å–æ–ª–∏
- –î–æ–±–∞–≤–∏—Ç—å RotatingFileHandler –¥–ª—è —Ñ–∞–π–ª–∞ (–µ—Å–ª–∏ LOG_FILE)
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤

**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è:**
```python
setup_logging() -> logging.Logger
```

**–§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤:**
```
[%(asctime)s] %(levelname)s %(name)s: %(message)s
```

### 3. channel_registry.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –•—Ä–∞–Ω–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –≤ –ø–∞–º—è—Ç–∏
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å/–∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ `channels.json`
- –£–ø—Ä–∞–≤–ª—è—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Ñ–ª–∞–≥–æ–º –≤–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è

**–ö–ª–∞—Å—Å ChannelRegistry:**
```python
class ChannelRegistry:
    enabled: bool              # –ì–ª–æ–±–∞–ª—å–Ω–æ –≤–∫–ª—é—á–µ–Ω–∞ –ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞
    channels: set[str]         # –ú–Ω–æ–∂–µ—Å—Ç–≤–æ username –∫–∞–Ω–∞–ª–æ–≤ (@name)

    def add(username: str) -> bool
    def remove(username: str) -> bool
    def is_active(username: str) -> bool
    def enable() -> bool
    def disable() -> bool
```

**–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:**
- –§–æ—Ä–º–∞—Ç: `channels.json` —Å JSON —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

### 4. gateway_client.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å OpenClaw Gateway —á–µ—Ä–µ–∑ WebSocket

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –í—ã–ø–æ–ª–Ω–∏—Ç—å handshake —Å HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å—é
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- –°–ª—É—à–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ –∫–æ–º–∞–Ω–¥—ã
- –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

**–ö–ª–∞—Å—Å GatewayClient:**
```python
class GatewayClient:
    gateway_url: str
    token: str
    websocket: websockets.WebSocketClientProtocol | None
    request_id: int              # Auto-increment –¥–ª—è req —Ñ—Ä–µ–π–º–æ–≤

    async def connect() -> None
    async def send_event(method: str, params: dict | None) -> int
    async def send_raw(frame: dict) -> bool
    async def listen(callback) -> None
    async def close() -> None
```

**WebSocket —Ñ—Ä–µ–π–º—ã:**

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```json
{
  "type": "connect",
  "nonce": "hex_string",
  "signature": "hmac_sha256"
}
```

–°–æ–±—ã—Ç–∏–µ (–∑–∞–ø—Ä–æ—Å):
```json
{
  "type": "req",
  "id": 1,
  "method": "message.ingest",
  "params": {...}
}
```

–û—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É:
```json
{
  "type": "res",
  "id": 1,
  "ok": true,
  "payload": {...}
}
```

### 5. tg_client.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Pyrogram –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –°–æ–∑–¥–∞—Ç—å Pyrogram Client —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ config
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–æ–≤
- –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

**–§—É–Ω–∫—Ü–∏–∏:**
```python
def build_client() -> Client
def register_handlers(app: Client, gateway, registry) -> None
```

**–§–∏–ª—å—Ç—Ä—ã Pyrogram:**
- `filters.channel` - —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–æ–≤
- `filters.private` - –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### 6. handlers/channel_handler.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –∫–∞–Ω–∞–ª–æ–≤

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –∫–∞–Ω–∞–ª –≤ —Ä–µ–µ—Å—Ç—Ä–µ (`registry.is_active`)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ username –∫–∞–Ω–∞–ª–∞
- –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (—Ç–µ–∫—Å—Ç, –∞–≤—Ç–æ—Ä, –≤—Ä–µ–º—è)
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `message.ingest` –≤ OpenClaw

**–õ–æ–≥–∏–∫–∞:**
```
1. –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Pyrogram
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å message.chat.username
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å registry.is_active(username)
4. –ï—Å–ª–∏ inactive ‚Üí return (–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)
5. –ò–∑–≤–ª–µ—á—å: id, title, message_id, text, timestamp, from_user
6. –í—ã–∑–≤–∞—Ç—å gateway.send_event("message.ingest", payload)
```

### 7. handlers/private_handler.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (DM)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ñ–ª–∞–≥ –≤–∫–ª—é—á–µ–Ω–∏—è (`registry.enabled`)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
- –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ `message.ingest` –≤ OpenClaw

**–õ–æ–≥–∏–∫–∞:**
```
1. –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç Pyrogram
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å registry.enabled
3. –ï—Å–ª–∏ disabled ‚Üí return (–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å)
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å message.from_user
5. –ò–∑–≤–ª–µ—á—å: chat_id, message_id, text, timestamp, from_user
6. –í—ã–∑–≤–∞—Ç—å gateway.send_event("message.ingest", payload)
```

### 8. command_handler.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –æ—Ç OpenClaw Gateway

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –†–∞–∑–±–∏—Ä–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Ñ—Ä–µ–π–º—ã –∫–æ–º–∞–Ω–¥
- –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –≤ —Ä–µ–µ—Å—Ç—Ä–µ
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–§—É–Ω–∫—Ü–∏—è:**
```python
async def handle_gateway_command(
    frame: dict,
    registry: ChannelRegistry,
    gateway: GatewayClient | None = None,
    app = None
) -> dict
```

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç–æ–¥—ã:**
- `channel.add` ‚Üí registry.add(username)
- `channel.remove` ‚Üí registry.remove(username)
- `bot.enable` ‚Üí registry.enable()
- `bot.disable` ‚Üí registry.disable()

**–û—Ç–≤–µ—Ç:**
```json
{
  "type": "res",
  "id": frame_id,
  "ok": true|false,
  "payload": {...} | "error": "description"
}
```

### 9. main.py
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- –°–æ–∑–¥–∞—Ç—å –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Gateway Client
- –°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å Pyrogram Client
- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ü–∏–∫–ª –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥
- –û–±—Ä–∞–±–æ—Ç–∞—Ç—å graceful shutdown

**–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:**
```
1. setup_logging()
2. –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å TELEGRAM_API_ID –∏ TELEGRAM_API_HASH
3. –°–æ–∑–¥–∞—Ç—å registry = ChannelRegistry()
4. –°–æ–∑–¥–∞—Ç—å gateway = GatewayClient(...)
5. await gateway.connect()
6. app = build_client()
7. register_handlers(app, gateway, registry)
8. –°–æ–∑–¥–∞—Ç—å task: gateway.listen(command_callback)
9. await app.start()
10. await idle()
11. Cleanup: app.stop(), gateway.close()
```

## üîÑ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### Event Loop –≥–ª–∞–≤–Ω—ã—Ö –∑–∞–¥–∞—á:

```python
asyncio.run(main())
  ‚îÇ
  ‚îú‚îÄ gateway.connect()              # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OpenClaw
  ‚îÇ   ‚îî‚îÄ WebSocket handshake
  ‚îÇ
  ‚îú‚îÄ asyncio.create_task(gateway.listen(callback))  # –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞
  ‚îÇ   ‚îî‚îÄ –°–ª—É—à–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∫–æ–º–∞–Ω–¥—ã
  ‚îÇ      ‚îî‚îÄ handle_gateway_command()
  ‚îÇ         ‚îî‚îÄ registry.add/remove/enable/disable()
  ‚îÇ         ‚îî‚îÄ gateway.send_raw(response)
  ‚îÇ
  ‚îú‚îÄ app.start()                    # Pyrogram –∫–ª–∏–µ–Ω—Ç
  ‚îÇ   ‚îî‚îÄ –°–ª—É—à–∞–µ—Ç Telegram —Å–æ–æ–±—â–µ–Ω–∏—è
  ‚îÇ      ‚îî‚îÄ on_channel_message()
  ‚îÇ         ‚îî‚îÄ gateway.send_event("message.ingest")
  ‚îÇ      ‚îî‚îÄ on_private_message()
  ‚îÇ         ‚îî‚îÄ gateway.send_event("message.ingest")
  ‚îÇ
  ‚îî‚îÄ idle()                         # –î–µ—Ä–∂–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∂–∏–≤—ã–º
```

## üìä –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ Telegram –∫–∞–Ω–∞–ª–∞:

```
Telegram Network
  ‚îÇ
  ‚îî‚îÄ Pyrogram Client
      ‚îÇ
      ‚îî‚îÄ @on_message(filters.channel)
          ‚îÇ
          ‚îî‚îÄ handle_channel_message()
              ‚îÇ
              ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å registry.is_active(channel)
              ‚îÇ
              ‚îú‚îÄ –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
              ‚îÇ
              ‚îî‚îÄ gateway.send_event("message.ingest", {...})
                  ‚îÇ
                  ‚îî‚îÄ GatewayClient.send_event()
                      ‚îÇ
                      ‚îî‚îÄ WebSocket.send({type:"req", id, method, params})
                          ‚îÇ
                          ‚îî‚îÄ OpenClaw Gateway
```

### –í—Ö–æ–¥—è—â–∞—è –∫–æ–º–∞–Ω–¥–∞ –æ—Ç OpenClaw:

```
OpenClaw Gateway
  ‚îÇ
  ‚îî‚îÄ WebSocket.recv()
      ‚îÇ
      ‚îî‚îÄ GatewayClient.listen(callback)
          ‚îÇ
          ‚îî‚îÄ callback(frame) ‚Üí handle_gateway_command(frame, registry, gateway)
              ‚îÇ
              ‚îú‚îÄ –ü–∞—Ä—Å–∏—Ç—å method –∏ params
              ‚îÇ
              ‚îú‚îÄ –í—ã–ø–æ–ª–Ω–∏—Ç—å operation (add/remove/enable/disable)
              ‚îÇ
              ‚îî‚îÄ gateway.send_raw({type:"res", id, ok, payload|error})
                  ‚îÇ
                  ‚îî‚îÄ WebSocket.send()
                      ‚îÇ
                      ‚îî‚îÄ OpenClaw Gateway
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è WebSocket:

1. **HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å:**
   ```python
   nonce = secrets.token_hex(16)                    # 32 —Å–∏–º–≤–æ–ª–∞
   signature = hmac.new(
       token.encode(),
       nonce.encode(),
       hashlib.sha256
   ).hexdigest()
   ```

2. **Handshake —Ñ—Ä–µ–π–º:**
   ```json
   {
     "type": "connect",
     "nonce": "a1b2c3...",
     "signature": "sha256_hash_of_token_xor_nonce"
   }
   ```

3. **–ó–∞—â–∏—Ç–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - `.env` —Ñ–∞–π–ª –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è (–≤ `.gitignore`)
   - –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –ü–∞—Ä–æ–ª–∏ Telegram –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### –í–∞–ª–∏–¥–∞—Ü–∏—è:

- –í—Ö–æ–¥—è—â–∏–µ JSON —Ñ—Ä–µ–π–º—ã –ø–∞—Ä—Å—è—Ç—Å—è —Å error handling
- –ö–æ–º–∞–Ω–¥—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
python -m py_compile config.py logger.py channel_registry.py gateway_client.py tg_client.py command_handler.py handlers/*.py main.py

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
python -c "import config; import logger; import gateway_client; print('OK')"

# –ó–∞–ø—É—Å–∫ —Å DEBUG –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
LOG_LEVEL=DEBUG python main.py
```

### –ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ OpenClaw Gateway:

```bash
# –ü—Ä–æ—Å—Ç–æ–π WebSocket —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
python -m websockets ws://localhost:3000
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

1. **Async/await**: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞
2. **JSON –ø–∞—Ä—Å–∏–Ω–≥**: –ü–∞—Ä—Å–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ñ—Ä–µ–π–º–æ–≤
3. **Registry –≤ –ø–∞–º—è—Ç–∏**: –ë—ã—Å—Ç—Ä—ã–π O(1) –¥–æ—Å—Ç—É–ø –∫ –∫–∞–Ω–∞–ª–∞–º
4. **–†–æ—Ç–∏—Ä—É—é—â–∏–µ –ª–æ–≥–∏**: –ù–µ —Ä–∞—Å—Ç—É—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:

- **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∫–∞–Ω–∞–ª–æ–≤**: set[str] –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è —Ö–æ—Ä–æ—à–æ
- **–ß–∞—Å—Ç—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: Async –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ DM**: –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –º–æ–¥—É–ª—è–º:

```python
logger = logging.getLogger("parser.gateway")     # –¥–ª—è gateway_client.py
logger = logging.getLogger("parser.handler.channel")  # –¥–ª—è channel_handler.py
logger = logging.getLogger("parser.command")      # –¥–ª—è command_handler.py
```

### –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –≤—ã–∑–æ–≤–æ–≤:

```env
LOG_LEVEL=DEBUG    # –í—Å–µ –¥–µ—Ç–∞–ª–∏ —Ñ—Ä–µ–π–º–æ–≤
```

### –ò–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```python
# –í interactive —Ä–µ–∂–∏–º–µ
python -i main.py
>>> registry.channels
>>> registry.enabled
```

## üìö –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã:

1. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ `command_handler.py`:
```python
elif method == "custom.command":
    result = registry.do_something()
    response = {
        "type": "res",
        "id": frame_id,
        "ok": True,
        "payload": {"result": result}
    }
```

2. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `logger.py` (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ WebSocket

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä–∞ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:

1. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –≤ `handlers/new_handler.py`
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ `tg_client.py`:
```python
@app.on_message(filters.new_filter)
async def on_new_message(client, message):
    await handle_new_message(client, message, gateway, registry)
```

3. –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ `gateway.send_event()`

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

```
main.py
  ‚îú‚îÄ‚îÄ config.py              (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
  ‚îú‚îÄ‚îÄ logger.py              (setup_logging)
  ‚îú‚îÄ‚îÄ tg_client.py           (build_client, register_handlers)
  ‚îÇ   ‚îî‚îÄ‚îÄ handlers/
  ‚îÇ       ‚îú‚îÄ‚îÄ channel_handler.py
  ‚îÇ       ‚îî‚îÄ‚îÄ private_handler.py
  ‚îú‚îÄ‚îÄ gateway_client.py      (GatewayClient)
  ‚îú‚îÄ‚îÄ channel_registry.py    (ChannelRegistry)
  ‚îî‚îÄ‚îÄ command_handler.py     (handle_gateway_command)

gateway_client.py
  ‚îî‚îÄ‚îÄ (no internal deps)

channel_registry.py
  ‚îî‚îÄ‚îÄ (no internal deps)

command_handler.py
  ‚îî‚îÄ‚îÄ (no internal deps)

tg_client.py
  ‚îî‚îÄ‚îÄ handlers/*

config.py
  ‚îî‚îÄ‚îÄ (external: dotenv)
```

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è:
```python
request_id = await gateway.send_event("message.ingest", {
    "message_id": 42,
    "text": "Hello",
    "timestamp": 1708884000.0
})
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞:
```python
registry.add("@news_channel")
# –õ–æ–≥–∏—Ä—É–µ—Ç: "INFO registry: Added channel @news_channel"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–∞–Ω–∞–ª–∞:
```python
if registry.is_active("@news_channel"):
    # –ö–∞–Ω–∞–ª –∞–∫—Ç–∏–≤–µ–Ω –∏ –±–æ—Ç –≤–∫–ª—é—á–µ–Ω
    pass
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```python
registry.disable()
# –õ–æ–≥–∏—Ä—É–µ—Ç: "INFO registry: Bot disabled"
# –¢–µ–ø–µ—Ä—å registry.enabled = False
```
